/*!
 * Polyfill.js - v0.1.0
 *
 * Copyright (c) 2013 Philip Walton <http://philipwalton.com>
 * Released under the MIT license
 *
 * Date: 2013-05-04
 */
(function(e,t){"use strict";function n(e){return e.replace(/^\s+|\s+$/g,"")}function r(e,t){var n,r=0;if(!e||!t)return!1;for(;n=t[r++];)if(e===n)return!0;return!1}function i(e){return u.test(e)}function s(e){var t,n=0;for(this._rules=[];t=e[n++];)this._rules.push(new o(t))}function o(e){this._rule=e}function a(e,t,n){return this instanceof a?(this._keywords=e,this._options=t||{},this._callback=n,this._promise=[],this._getStylesheetURLs(),this._downloadStylesheets(),this._parseStylesheets(),this._filterCSSByKeywords(),this._buildMediaQueryMap(),this._reportInitialMatches(),this._reportMatchesOnMediaChanges(),undefined):new a(e,t,n)}var u=RegExp("^"+({}.valueOf+"").replace(/[.*+?\^${}()|\[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),c={matchMedia:e.matchMedia&&e.matchMedia("only all").matches,nativeMatchMedia:i(e.matchMedia)},f=function(){function t(e){for(var t,n=0;t=e[n++];)u[t]||r(t,c)||c.push(t)}function n(){if(0===h.readyState||4===h.readyState){var e;(e=c[0])&&i(e),e||o()}}function i(e){l++,h.open("GET",e,!0),h.onreadystatechange=function(){4!=h.readyState||200!=h.status&&304!=h.status||(u[e]=h.responseText,c.shift(),n())},h.send(null)}function s(e){for(var t,n=0,r=0;t=e[n++];)u[t]&&r++;return r===e.length}function o(){for(var e;e=f.shift();)a(e.urls,e.fn)}function a(e,t){for(var n,r=[],i=0;n=e[i++];)r.push({url:n,css:u[n]});t.call(null,r)}var u={},c=[],f=[],l=0,h=function(){var t;try{t=new e.XMLHttpRequest}catch(n){t=new e.ActiveXObject("Microsoft.XMLHTTP")}return t}();return{request:function(e,r){f.push({urls:e,fn:r}),s(e)?o():(t(e),n())},clearCache:function(){u={}},_getRequestCount:function(){return l}}}(),l={_cache:{},clearCache:function(){l._cache={}},parse:function(e,t){function r(){return o(/^\{\s*/)}function i(){return o(/^\}\s*/)}function s(){var t,n=[];for(a(),u(n);"}"!=e.charAt(0)&&(t=E()||C());)n.push(t),u(n);return n}function o(t){var n=t.exec(e);if(n)return e=e.slice(n[0].length),n}function a(){o(/^\s*/)}function u(e){e=e||[];for(var t;t=c();)e.push(t);return e}function c(){if("/"==e[0]&&"*"==e[1]){for(var t=2;"*"!=e[t]||"/"!=e[t+1];)++t;t+=2;var n=e.slice(2,t-2);return e=e.slice(t),a(),{comment:n}}}function f(){var e=o(/^([^{]+)/);if(e)return n(e[0]).split(/\s*,\s*/)}function h(){var e=o(/^(\*?[\-\w]+)\s*/);if(e&&(e=e[0],o(/^:\s*/))){var t=o(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)\s*/);if(t)return t=n(t[0]),o(/^[;\s]*/),{property:e,value:t}}}function d(){for(var e,t=[];e=o(/^(from|to|\d+%|\.\d+%|\d+\.\d+%)\s*/);)t.push(e[1]),o(/^,\s*/);return t.length?{values:t,declarations:w()}:undefined}function p(){var e=o(/^@([\-\w]+)?keyframes */);if(e){var t=e[1],e=o(/^([\-\w]+)\s*/);if(e){var n=e[1];if(r()){u();for(var s,a=[];s=d();)a.push(s),u();if(i()){var c={name:n,keyframes:a};return t&&(c.vendor=t),c}}}}}function v(){var e=o(/^@supports *([^{]+)/);if(e){var t=n(e[1]);if(r()){u();var a=s();if(i())return{supports:t,rules:a}}}}function m(){var e=o(/^@media *([^{]+)/);if(e){var t=n(e[1]);if(r()){u();var a=s();if(i())return{media:t,rules:a}}}}function _(){var e=o(/^@page */);if(e){var t=f()||[],n=[];if(r()){u();for(var s;s=h()||y();)n.push(s),u();if(i())return{type:"page",selectors:t,declarations:n}}}}function y(){var e=o(/^@([a-z\-]+) */);if(e){var t=e[1];return{type:t,declarations:w()}}}function M(){return S("import")}function g(){return S("charset")}function R(){return S("namespace")}function S(e){var t=o(RegExp("^@"+e+" *([^;\\n]+);\\s*"));if(t){var r={};return r[e]=n(t[1]),r}}function w(){var e=[];if(r()){u();for(var t;t=h();)e.push(t),u();if(i())return e}}function E(){return p()||m()||v()||M()||g()||R()||_()}function C(){var e=f();if(e)return u(),{selectors:e,declarations:w()}}return t&&l._cache[t]?l._cache[t]:(e=e.replace(/\/\*[\s\S]*?\*\//g,""),l._cache[t]=s())},filter:function(e,t){function r(e,t){return e||t?e?e.concat(t):[t]:undefined}function i(e){null==e.media&&delete e.media,null==e.supports&&delete e.supports,f.push(e)}function s(e,t){if(t)for(var n=t.length;n--;)if(e.indexOf(t[n])>=0)return!0}function o(e,t){for(var r,i,s,o,a=/\*/,u=0;r=t[u++];)if(i=r.split(":"),s=RegExp("^"+n(i[0]).replace(a,".*")+"$"),o=RegExp("^"+n(i[1]).replace(a,".*")+"$"),s.test(e.property)&&o.test(e.value))return!0}function a(e,n,r){return t.selectors?s(e.selectors.join(","),t.selectors)?(i({media:n,supports:r,selectors:e.selectors,declarations:e.declarations}),!0):undefined:undefined}function u(e,n,r){if(t.declarations)for(var s,a=0;s=e.declarations[a++];)if(o(s,t.declarations))return i({media:n,supports:r,selectors:e.selectors,declarations:e.declarations}),!0}function c(e,t,n){for(var i,s=0;i=e[s++];)i.declarations?a(i,t,n)||u(i,t,n):i.rules&&i.media?c(i.rules,r(t,i.media),n):i.rules&&i.supports&&c(i.rules,t,r(n,i.supports))}var f=[];return c(e),f}},h=function(){function n(){if(s)return s;var e=t.documentElement,n=t.body,r=e.style.fontSize,i=n.style.fontSize,o=t.createElement("div");return e.style.fontSize="1em",n.style.fontSize="1em",n.appendChild(o),o.style.width="1em",o.style.position="absolute",s=o.offsetWidth,n.removeChild(o),n.style.fontSize=i,e.style.fontSize=r,s}function r(t){return e.matchMedia(t)}function i(e){var r,i,s=!1;return o=t.documentElement.clientWidth,a.test(e)&&(r="em"===RegExp.$2?parseFloat(RegExp.$1)*n():parseFloat(RegExp.$1)),u.test(e)&&(i="em"===RegExp.$2?parseFloat(RegExp.$1)*n():parseFloat(RegExp.$1)),r&&i?s=o>=r&&i>=o:(r&&o>=r&&(s=!0),i&&i>=o&&(s=!0)),{matches:s,media:e}}var s,o,a=/\(min\-width:[\s]*([\s]*[0-9\.]+)(px|em)[\s]*\)/,u=/\(max\-width:[\s]*([\s]*[0-9\.]+)(px|em)[\s]*\)/,f={};return{matchMedia:function(e){return c.matchMedia?r(e):i(e)},clearCache:function(){c.nativeMatchMedia||(o=null,f={})}}}(),d=function(){function t(e,t){var n;return function(){clearTimeout(n),n=setTimeout(e,t)}}var n=function(){var e=[];return{add:function(t,n,r){for(var i,s=0;i=e[s++];)if(i.polyfill==t&&i.mql===n&&i.fn===r)return!1;n.addListener(r),e.push({polyfill:t,mql:n,fn:r})},remove:function(t){for(var n,r=0;n=e[r++];)n.polyfill===t&&(n.mql.removeListener(n.fn),e.splice(--r,1))}}}(),r=function(t){function n(){for(var e,n=0;e=t[n++];)e.fn()}return{add:function(r,i){t.length||(e.addEventListener?e.addEventListener("resize",n,!1):e.attachEvent("onresize",n)),t.push({polyfill:r,fn:i})},remove:function(r){for(var i,s=0;i=t[s++];)i.polyfill===r&&t.splice(--s,1);t.length||(e.removeEventListener?e.removeEventListener("resize",n,!1):e.detachEvent&&e.detachEvent("onresize",n))}}}([]);return{removeListeners:function(e){c.nativeMatchMedia?n.remove(e):r.remove(e)},addListeners:function(e,i){function s(){if(c.nativeMatchMedia)for(var s in a)a.hasOwnProperty(s)&&function(t,r){n.add(e,t,function(){i.call(e,r,t.matches)})}(a[s],s);else{var u=t(function(e,t){return function(){o(e,t)}}(e,a),e._options.debounceTimeout||100);r.add(e,u)}}function o(e,t){var n,r={};h.clearCache();for(n in t)t.hasOwnProperty(n)&&(r[n]=h.matchMedia(n).matches,r[n]!=u[n]&&i.call(e,n,h.matchMedia(n).matches));u=r}var a=e._mediaQueryMap,u={};(function(){for(var e in a)a.hasOwnProperty(e)&&(u[e]=h.matchMedia(e).matches)})(),s()}}}();s.prototype.each=function(e,t){var n,r=0;for(t||(t=this);n=this._rules[r++];)e.call(t,n)},s.prototype.size=function(){return this._rules.length},s.prototype.at=function(e){return this._rules[e]},o.prototype.getDeclaration=function(){for(var e,t={},n=0,r=this._rule.declarations;e=r[n++];)t[e.property]=e.value;return t},o.prototype.getSelectors=function(){return this._rule.selectors.join(", ")},o.prototype.getMedia=function(){return this._rule.media.join(" and ")},a.prototype.onReady=function(e){return this._onReady=e,this._resolve(),this},a.prototype.onMatchedMedia=function(e){return this._onMatchedMedia=e,this._resolve(),this},a.prototype.onUnmatchedMedia=function(e){return this._onUnmatchedMedia=e,this._resolve(),this},a.prototype.then=function(e){return this._callback=e,this._resolve(),this},a.prototype.getCurrentMatches=function(){for(var e,t,n=0,r=[];e=this._filteredRules[n++];)t=e.media&&e.media.join(" and "),(!t||h.matchMedia(t).matches)&&r.push(e);return new s(r)},a.prototype.destroy=function(){this._callback&&(this._callback(new s([]),this.getCurrentMatches()),d.removeListeners(this),this._callback=null)},a.prototype._defer=function(e,t){e.call(this)?t.call(this):this._promise.push({condition:e,callback:t})},a.prototype._resolve=function(){for(var e,t=0;e=this._promise[t];)e.condition.call(this)?(this._promise.splice(t,1),e.callback.call(this)):t++},a.prototype._getStylesheetURLs=function(){var e,n,i,s,o=0,a=[];if(this._options.include){for(n=this._options.include;e=n[o++];)(i=t.getElementById(e))&&a.push(i.href);return this._stylesheetURLs=a}for(n=this._options.exclude,s=t.getElementsByTagName("link");i=s[o++];)i.rel&&"stylesheet"===i.rel.toLowerCase()&&!r(i.id,n)&&a.push(i.href);return this._stylesheetURLs=a},a.prototype._downloadStylesheets=function(){var e=this;f.request(this._stylesheetURLs,function(t){e._stylesheets=t,e._resolve()})},a.prototype._parseStylesheets=function(){this._defer(function(){return this._stylesheets},function(){for(var e,t=0;e=this._stylesheets[t++];)this._parsedCSS=(this._parsedCSS||[]).concat(l.parse(e.css,e.url))})},a.prototype._filterCSSByKeywords=function(){this._defer(function(){return this._parsedCSS},function(){this._filteredRules=l.filter(this._parsedCSS,this._keywords)})},a.prototype._buildMediaQueryMap=function(){this._defer(function(){return this._filteredRules},function(){var e,t,n=0;for(this._mediaQueryMap={};t=this._filteredRules[n++];)t.media&&(e=t.media.join(" and "),this._mediaQueryMap[e]=h.matchMedia(e))})},a.prototype._reportInitialMatches=function(){this._defer(function(){return this._filteredRules&&this._onReady},function(){this._onReady(this.getCurrentMatches())})},a.prototype._reportMatchesOnMediaChanges=function(){this._defer(function(){return this._filteredRules&&this._onMatchedMedia&&this._onUnmatchedMedia},function(){d.addListeners(this,function(e,t){for(var n,r=0,i=[],o=[];n=this._filteredRules[r++];)n.media&&n.media.join(" and ")==e&&(t?i:o).push(n);i.length&&this._onMatchedMedia(new s(i)),o.length&&this._onUnmatchedMedia(new s(o))})})},a.modules={DownloadManager:f,StyleManager:l,MediaManager:h,EventManager:d},a.constructors={Ruleset:s,Rule:o},e.Polyfill=a})(window,document);