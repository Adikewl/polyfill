/*!
 * Polyfill.js - v0.1.0
 *
 * Copyright (c) 2013 Philip Walton <http://philipwalton.com>
 * Released under the MIT license
 *
 * Date: 2013-04-28
 */
(function(e,t){"use strict";function r(e){return e.replace(/^\s+|\s+$/g,"")}function n(e,t){var r,n=0;if(!e||!t)return!1;for(;r=t[n++];)if(e===r)return!0;return!1}function i(e){return u.test(e)}function s(e){var t,r=0;for(this._rules=[];t=e[r++];)this._rules.push(new a(t))}function a(e){this._rule=e}function o(e,t,r){return this instanceof o?(this._keywords=e,this._options=t||{},this._callback=r,this._promise=[],this._getStylesheetURLs(),this._downloadStylesheets(),this._parseStylesheets(),this._filterCSSByKeywords(),this._buildMediaQueryMap(),this._reportInitialMatches(),this._reportMatchesOnMediaChanges(),undefined):new o(e,t,r)}var u=RegExp("^"+({}.valueOf+"").replace(/[.*+?\^${}()|\[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),c={matchMedia:e.matchMedia&&e.matchMedia("only all").matches,nativeMatchMedia:i(e.matchMedia)},f=function(){function t(e){for(var t,r=0;t=e[r++];)u[t]||n(t,c)||c.push(t)}function r(){if(0===h.readyState||4===h.readyState){var e;(e=c[0])&&i(e),e||a()}}function i(e){l++,h.open("GET",e,!0),h.onreadystatechange=function(){4!=h.readyState||200!=h.status&&304!=h.status||(u[e]=h.responseText,c.shift(),r())},h.send(null)}function s(e){for(var t,r=0,n=0;t=e[r++];)u[t]&&n++;return n===e.length}function a(){for(var e;e=f.shift();)o(e.urls,e.fn)}function o(e,t){for(var r,n=[],i=0;r=e[i++];)n.push({url:r,css:u[r]});t.call(null,n)}var u={},c=[],f=[],l=0,h=function(){var t;try{t=new e.XMLHttpRequest}catch(r){t=new e.ActiveXObject("Microsoft.XMLHTTP")}return t}();return{request:function(e,n){f.push({urls:e,fn:n}),s(e)?a():(t(e),r())},clearCache:function(){u={}},_getRequestCount:function(){return l}}}(),l={_cache:{},clearCache:function(){l._cache={}},parse:function(e,t){function n(){return a(/^\{\s*/)}function i(){return a(/^\}\s*/)}function s(){var t,r=[];for(o(),u(r);"}"!=e.charAt(0)&&(t=E()||C());)r.push(t),u(r);return r}function a(t){var r=t.exec(e);if(r)return e=e.slice(r[0].length),r}function o(){a(/^\s*/)}function u(e){e=e||[];for(var t;t=c();)e.push(t);return e}function c(){if("/"==e[0]&&"*"==e[1]){for(var t=2;"*"!=e[t]||"/"!=e[t+1];)++t;t+=2;var r=e.slice(2,t-2);return e=e.slice(t),o(),{comment:r}}}function f(){var e=a(/^([^{]+)/);if(e)return r(e[0]).split(/\s*,\s*/)}function h(){var e=a(/^(\*?[\-\w]+)\s*/);if(e&&(e=e[0],a(/^:\s*/))){var t=a(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)\s*/);if(t)return t=r(t[0]),a(/^[;\s]*/),{property:e,value:t}}}function d(){for(var e,t=[];e=a(/^(from|to|\d+%|\.\d+%|\d+\.\d+%)\s*/);)t.push(e[1]),a(/^,\s*/);return t.length?{values:t,declarations:R()}:undefined}function p(){var e=a(/^@([\-\w]+)?keyframes */);if(e){var t=e[1],e=a(/^([\-\w]+)\s*/);if(e){var r=e[1];if(n()){u();for(var s,o=[];s=d();)o.push(s),u();if(i()){var c={name:r,keyframes:o};return t&&(c.vendor=t),c}}}}}function v(){var e=a(/^@supports *([^{]+)/);if(e){var t=r(e[1]);if(n()){u();var o=s();if(i())return{supports:t,rules:o}}}}function m(){var e=a(/^@media *([^{]+)/);if(e){var t=r(e[1]);if(n()){u();var o=s();if(i())return{media:t,rules:o}}}}function _(){var e=a(/^@page */);if(e){var t=f()||[],r=[];if(n()){u();for(var s;s=h()||y();)r.push(s),u();if(i())return{type:"page",selectors:t,declarations:r}}}}function y(){var e=a(/^@([a-z\-]+) */);if(e){var t=e[1];return{type:t,declarations:R()}}}function M(){return w("import")}function g(){return w("charset")}function S(){return w("namespace")}function w(e){var t=a(RegExp("^@"+e+" *([^;\\n]+);\\s*"));if(t){var n={};return n[e]=r(t[1]),n}}function R(){var e=[];if(n()){u();for(var t;t=h();)e.push(t),u();if(i())return e}}function E(){return p()||m()||v()||M()||g()||S()||_()}function C(){var e=f();if(e)return u(),{selectors:e,declarations:R()}}return t&&l._cache[t]?l._cache[t]:(e=e.replace(/\/\*[\s\S]*?\*\//g,""),l._cache[t]=s())},filter:function(e,t){function n(e,t){return e||t?e?e.concat(t):[t]:undefined}function i(e){null==e.media&&delete e.media,null==e.supports&&delete e.supports,f.push(e)}function s(e,t){if(t)for(var r=t.length;r--;)if(e.indexOf(t[r])>=0)return!0}function a(e,t){for(var n,i,s,a,o=/\*/,u=0;n=t[u++];)if(i=n.split(":"),s=RegExp("^"+r(i[0]).replace(o,".*")+"$"),a=RegExp("^"+r(i[1]).replace(o,".*")+"$"),s.test(e.property)&&a.test(e.value))return!0}function o(e,r,n){return t.selectors?s(e.selectors.join(","),t.selectors)?(i({media:r,supports:n,selectors:e.selectors,declarations:e.declarations}),!0):undefined:undefined}function u(e,r,n){if(t.declarations)for(var s,o=0;s=e.declarations[o++];)if(a(s,t.declarations))return i({media:r,supports:n,selectors:e.selectors,declarations:e.declarations}),!0}function c(e,t,r){for(var i,s=0;i=e[s++];)i.declarations?o(i,t,r)||u(i,t,r):i.rules&&i.media?c(i.rules,n(t,i.media),r):i.rules&&i.supports&&c(i.rules,t,n(r,i.supports))}var f=[];return c(e),f}},h=function(){function r(){if(s)return s;var e=t.documentElement,r=t.body,n=e.style.fontSize,i=r.style.fontSize,a=t.createElement("div");return e.style.fontSize="1em",r.style.fontSize="1em",r.appendChild(a),a.style.width="1em",a.style.position="absolute",s=a.offsetWidth,r.removeChild(a),r.style.fontSize=i,e.style.fontSize=n,s}function n(t){return e.matchMedia(t)}function i(e){var n,i,s=!1;return a=t.documentElement.clientWidth,o.test(e)&&(n="em"===RegExp.$2?parseFloat(RegExp.$1)*r():parseFloat(RegExp.$1)),u.test(e)&&(i="em"===RegExp.$2?parseFloat(RegExp.$1)*r():parseFloat(RegExp.$1)),n&&i?s=a>=n&&i>=a:(n&&a>=n&&(s=!0),i&&i>=a&&(s=!0)),{matches:s,media:e}}var s,a,o=/\(min\-width:[\s]*([\s]*[0-9\.]+)(px|em)[\s]*\)/,u=/\(max\-width:[\s]*([\s]*[0-9\.]+)(px|em)[\s]*\)/,f={};return{matchMedia:function(e){return c.matchMedia?n(e):i(e)},clearCache:function(){c.nativeMatchMedia||(a=null,f={})}}}(),d=function(){function t(e,t){var r;return function(){clearTimeout(r),r=setTimeout(e,t)}}var r=function(){var e=[];return{add:function(t,r,n){for(var i,s=0;i=e[s++];)if(i.polyfill==t&&i.mql===r&&i.fn===n)return!1;r.addListener(n),e.push({polyfill:t,mql:r,fn:n})},remove:function(t){for(var r,n=0;r=e[n++];)r.polyfill===t&&(r.mql.removeListener(r.fn),e.splice(--n,1))}}}(),n=function(t){function r(){for(var e,r=0;e=t[r++];)e.fn()}return{add:function(n,i){t.length||(e.addEventListener?e.addEventListener("resize",r,!1):e.attachEvent("onresize",r)),t.push({polyfill:n,fn:i})},remove:function(n){for(var i,s=0;i=t[s++];)i.polyfill===n&&t.splice(--s,1);t.length||(e.removeEventListener?e.removeEventListener("resize",r,!1):e.detachEvent&&e.detachEvent("onresize",r))}}}([]);return{removeListeners:function(e){c.nativeMatchMedia?r.remove(e):n.remove(e)},addListeners:function(e,i){function s(){if(c.nativeMatchMedia)for(var s in o)o.hasOwnProperty(s)&&function(t,n){r.add(e,t,function(){i.call(e,n,t.matches)})}(o[s],s);else{var u=t(function(e,t){return function(){a(e,t)}}(e,o),e._options.debounceTimeout||100);n.add(e,u)}}function a(e,t){var r,n={};h.clearCache();for(r in t)t.hasOwnProperty(r)&&(n[r]=h.matchMedia(r).matches,n[r]!=u[r]&&i.call(e,r,h.matchMedia(r).matches));u=n}var o=e._mediaQueryMap,u={};(function(){for(var e in o)o.hasOwnProperty(e)&&(u[e]=h.matchMedia(e).matches)})(),s()}}}();s.prototype.each=function(e,t){var r,n=0;for(t||(t=this);r=this._rules[n++];)e.call(t,r)},s.prototype.size=function(){return this._rules.length},s.prototype.at=function(e){return this._rules[e]},a.prototype.getDeclaration=function(){for(var e,t={},r=0,n=this._rule.declarations;e=n[r++];)t[e.property]=e.value;return t},a.prototype.getSelectors=function(){return this._rule.selectors.join(", ")},a.prototype.getMedia=function(){return this._rule.media.join(" and ")},o.prototype.then=function(e){return this._callback=e,this._resolve(),this},o.prototype.getCurrentMatches=function(){for(var e,t,r=0,n=[];e=this._filteredRules[r++];)t=e.media&&e.media.join(" and "),(!t||h.matchMedia(t).matches)&&n.push(e);return new s(n)},o.prototype.destroy=function(){this._callback&&(this._callback(new s([]),this.getCurrentMatches()),d.removeListeners(this),this._callback=null)},o.prototype._defer=function(e,t){e.call(this)?t.call(this):this._promise.push({condition:e,callback:t})},o.prototype._resolve=function(){for(var e,t=0;e=this._promise[t];)e.condition.call(this)?(this._promise.splice(t,1),e.callback.call(this)):t++},o.prototype._getStylesheetURLs=function(){var e,r,i,s,a=0,o=[];if(this._options.include){for(r=this._options.include;e=r[a++];)(i=t.getElementById(e))&&o.push(i.href);return this._stylesheetURLs=o}for(r=this._options.exclude,s=t.getElementsByTagName("link");i=s[a++];)i.rel&&"stylesheet"===i.rel.toLowerCase()&&!n(i.id,r)&&o.push(i.href);return this._stylesheetURLs=o},o.prototype._downloadStylesheets=function(){var e=this;f.request(this._stylesheetURLs,function(t){e._stylesheets=t,e._resolve()})},o.prototype._parseStylesheets=function(){this._defer(function(){return this._stylesheets},function(){for(var e,t=0;e=this._stylesheets[t++];)this._parsedCSS=(this._parsedCSS||[]).concat(l.parse(e.css,e.url))})},o.prototype._filterCSSByKeywords=function(){this._defer(function(){return this._parsedCSS},function(){this._filteredRules=l.filter(this._parsedCSS,this._keywords)})},o.prototype._buildMediaQueryMap=function(){this._defer(function(){return this._filteredRules},function(){var e,t,r=0;for(this._mediaQueryMap={};t=this._filteredRules[r++];)t.media&&(e=t.media.join(" and "),this._mediaQueryMap[e]=h.matchMedia(e))})},o.prototype._reportInitialMatches=function(){this._defer(function(){return this._filteredRules&&this._callback},function(){this._callback(this.getCurrentMatches(),new s([]),this)})},o.prototype._reportMatchesOnMediaChanges=function(){this._defer(function(){return this._filteredRules&&this._callback},function(){d.addListeners(this,function(e,t){for(var r,n=0,i=[],a=[];r=this._filteredRules[n++];)r.media&&r.media.join(" and ")==e&&(t?i:a).push(r);this._callback(new s(i),new s(a),this)},this)})},o.modules={DownloadManager:f,StyleManager:l,MediaManager:h,EventManager:d},o.constructors={Ruleset:s,Rule:a},e.Polyfill=o})(window,document);